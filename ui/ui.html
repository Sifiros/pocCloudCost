<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.19.1/moment.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.19.1/locale/fr.js"></script>
<script
  src="https://code.jquery.com/jquery-3.2.1.min.js"
  integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
  crossorigin="anonymous"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.1/Chart.min.js"></script>
<script type="text/javascript" src="./savingChart.js"></script>
<script type="text/javascript" src="./horizontalLineChartPlugin.js"></script>
<script type="text/javascript" src="./eventSavings.json"></script>
<style>
    canvas {
        -moz-user-select: none;
        -webkit-user-select: none;
        -ms-user-select: none;
    }
</style>
<h1>Test</h1>
<div style="width:75%;">
    <canvas id="teevityChart"></canvas>
</div>

<!-- create a table with elems created by caussa -->

<div id="tableContainer">
        <table id = "dataTable"></table>
</div>

<script>

    window.onload = function() {
            registerPlugin('teevityChart');
            var datasets = Object.keys(datas.events).map(function (eventName) {
                return metricsToDataset(eventName, datas.events[eventName])
            })
            datasets.push(metricsToDataset('Total costs', datas.costs))
            window.chart = new TeevityChart('teevityChart', 'Teevity Savings', datasets)
            // window.addMockDataset();
            window.chart.refresh();

            function metricsToDataset(datasetName, resources) {
                return ({
                    label: datasetName,
                    data: resources.map(function (cur) {
                        cur.value = (typeof cur.saving != 'undefined' ? cur.saving : cur.costs);
                        return cur;
                    }),
                    fill: true
                });
            }
            var tabScopes = datas.eventScopes;
            var strToAppend = "<tr><td style=' color: red;'>startDate</td>";
            strToAppend += "<td style='color: red;'>endDate</td>";
            strToAppend += "<td style='color: red;'>savings</td></tr>";
            var totalEarned = 0;

            for (x in tabScopes) {

                console.log(tabScopes[x]);
                strToAppend += "<tr><td>" + x + "</td></tr>";
                tabScopes[x].forEach(function (item) {

                    totalEarned += item.totalSaving;
                    strToAppend += "<tr><td style='color: blue; text-align: right;'>" + item.startDate + "</td>";
                    strToAppend += "<td style='color: blue; text-align: right;'>" + item.endDate + "</td>";
                    strToAppend += "<td style='color: blue; text-align: right;'>" + item.totalSaving + "</td></tr>";
                    console.log(item);
                });
            }
            strToAppend = "<tr><td style='color: green;'>" + "The total amount of Savings in this period is " + totalEarned + "</td></tr>" + strToAppend;

            $('#dataTable').append(strToAppend);
    }
</script>
<!--
<script>
var rows = 6,
cols = 7;

        for(var i = 0; i < rows; i++) {
            $('table').append('<tr></tr>');
            for(var j = 0; j < cols; j++) {
                $('table').find('tr').eq(i).append('<td></td>');
                $('table').find('tr').eq(i).find('td').eq(j).attr('data-row',          i).attr('data-col', j);
            }
        }
</script>
-->